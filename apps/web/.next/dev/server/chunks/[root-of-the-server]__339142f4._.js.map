{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 70, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/PC/Desktop/Our_Stocks_Project/apps/web/src/app/api/auth/login/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\nimport bcrypt from 'bcryptjs';\nimport jwt from 'jsonwebtoken';\nimport { drizzle } from 'drizzle-orm/neon-http';\nimport { neon } from '@neondatabase/serverless';\nimport { pgTable, serial, text, varchar, timestamp } from 'drizzle-orm/pg-core';\nimport { eq } from 'drizzle-orm';\n\n// Schema users\nconst users = pgTable('users', {\n  id: serial('id').primaryKey(),\n  name: text('name').notNull(),\n  email: text('email').notNull(),\n  password_hash: text('password_hash').notNull(),\n  avatar_url: text('avatar_url'),\n  role: text('role').default('user'),\n  created_at: timestamp('created_at').defaultNow(),\n  updated_at: timestamp('updated_at').defaultNow(),\n  status: varchar('status', { length: 255 }).default('active'),\n  last_login: timestamp('last_login'),\n});\n\nconst sql = neon(process.env.DATABASE_URL!);\nconst db = drizzle(sql);\n\nconst JWT_SECRET = process.env.JWT_SECRET || 'your-secret-key';\n\nexport async function POST(request: NextRequest) {\n  try {\n    const { email, password } = await request.json();\n\n    const [user] = await db\n      .select()\n      .from(users)\n      .where(eq(users.email, email.toLowerCase()));\n\n    if (!user || !await bcrypt.compare(password, user.password_hash)) {\n      return NextResponse.json(\n        { success: false, error: 'Invalid credentials' },\n        { status: 401 }\n      );\n    }\n\n    await db.update(users).set({ last_login: new Date() }).where(eq(users.id, user.id));\n\n    const token = jwt.sign(\n      { userId: user.id, email: user.email, role: user.role },\n      JWT_SECRET,\n      { expiresIn: '7d' }\n    );\n\n    return NextResponse.json({\n      success: true,\n      data: {\n        token,\n        user: { id: user.id, name: user.name, email: user.email, role: user.role },\n      },\n    });\n  } catch (error: any) {\n    console.error('Login error:', error);\n    return NextResponse.json(\n      { success: false, error: error.message },\n      { status: 500 }\n    );\n  }\n}"],"names":[],"mappings":";;;;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;;;;;;;;AAEA,eAAe;AACf,MAAM,QAAQ,IAAA,2QAAO,EAAC,SAAS;IAC7B,IAAI,IAAA,sRAAM,EAAC,MAAM,UAAU;IAC3B,MAAM,IAAA,kRAAI,EAAC,QAAQ,OAAO;IAC1B,OAAO,IAAA,kRAAI,EAAC,SAAS,OAAO;IAC5B,eAAe,IAAA,kRAAI,EAAC,iBAAiB,OAAO;IAC5C,YAAY,IAAA,kRAAI,EAAC;IACjB,MAAM,IAAA,kRAAI,EAAC,QAAQ,OAAO,CAAC;IAC3B,YAAY,IAAA,4RAAS,EAAC,cAAc,UAAU;IAC9C,YAAY,IAAA,4RAAS,EAAC,cAAc,UAAU;IAC9C,QAAQ,IAAA,wRAAO,EAAC,UAAU;QAAE,QAAQ;IAAI,GAAG,OAAO,CAAC;IACnD,YAAY,IAAA,4RAAS,EAAC;AACxB;AAEA,MAAM,MAAM,IAAA,yOAAI,EAAC,QAAQ,GAAG,CAAC,YAAY;AACzC,MAAM,KAAK,IAAA,8QAAO,EAAC;AAEnB,MAAM,aAAa,QAAQ,GAAG,CAAC,UAAU,IAAI;AAEtC,eAAe,KAAK,OAAoB;IAC7C,IAAI;QACF,MAAM,EAAE,KAAK,EAAE,QAAQ,EAAE,GAAG,MAAM,QAAQ,IAAI;QAE9C,MAAM,CAAC,KAAK,GAAG,MAAM,GAClB,MAAM,GACN,IAAI,CAAC,OACL,KAAK,CAAC,IAAA,mRAAE,EAAC,MAAM,KAAK,EAAE,MAAM,WAAW;QAE1C,IAAI,CAAC,QAAQ,CAAC,MAAM,mMAAM,CAAC,OAAO,CAAC,UAAU,KAAK,aAAa,GAAG;YAChE,OAAO,+QAAY,CAAC,IAAI,CACtB;gBAAE,SAAS;gBAAO,OAAO;YAAsB,GAC/C;gBAAE,QAAQ;YAAI;QAElB;QAEA,MAAM,GAAG,MAAM,CAAC,OAAO,GAAG,CAAC;YAAE,YAAY,IAAI;QAAO,GAAG,KAAK,CAAC,IAAA,mRAAE,EAAC,MAAM,EAAE,EAAE,KAAK,EAAE;QAEjF,MAAM,QAAQ,2MAAG,CAAC,IAAI,CACpB;YAAE,QAAQ,KAAK,EAAE;YAAE,OAAO,KAAK,KAAK;YAAE,MAAM,KAAK,IAAI;QAAC,GACtD,YACA;YAAE,WAAW;QAAK;QAGpB,OAAO,+QAAY,CAAC,IAAI,CAAC;YACvB,SAAS;YACT,MAAM;gBACJ;gBACA,MAAM;oBAAE,IAAI,KAAK,EAAE;oBAAE,MAAM,KAAK,IAAI;oBAAE,OAAO,KAAK,KAAK;oBAAE,MAAM,KAAK,IAAI;gBAAC;YAC3E;QACF;IACF,EAAE,OAAO,OAAY;QACnB,QAAQ,KAAK,CAAC,gBAAgB;QAC9B,OAAO,+QAAY,CAAC,IAAI,CACtB;YAAE,SAAS;YAAO,OAAO,MAAM,OAAO;QAAC,GACvC;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}